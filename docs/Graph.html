<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Graph  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
  </head>
  <body>
    <a name="//apple_ref/swift/Section/Graph" class="dashAnchor"></a>
    <a title="Graph  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html">ARISES Docs</a></p>
        <p class="header-right"><a href="https://github.com/danwells96/ARISES"><img src="img/gh.png"/>View on GitHub</a></p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">ARISES Reference</a>
        <img id="carat" src="img/carat.png" />
        Graph  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Documentation.html">Documentation</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="client-design.html">Client Design</a>
              </li>
              <li class="nav-group-task">
                <a href="final-design.html">Final Design</a>
              </li>
              <li class="nav-group-task">
                <a href="design-process.html">Design Process</a>
              </li>
              <li class="nav-group-task">
                <a href="program-architecture.html">Program Architecture</a>
              </li>
              <li class="nav-group-task">
                <a href="testing.html">Testing</a>
              </li>
              <li class="nav-group-task">
                <a href="future-work.html">Future Work</a>
              </li>
              <li class="nav-group-task">
                <a href="ethics-report.html">Ethics Report</a>
              </li>
              <li class="nav-group-task">
                <a href="sustainability-report.html">Sustainability Report</a>
              </li>
              <li class="nav-group-task">
                <a href="meeting-minutes.html">Meeting Minutes</a>
              </li>
              <li class="nav-group-task">
                <a href="focus-group-report.html">Focus Group Report</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Model.html">Model</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/ModelController.html">ModelController</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/PersistenceService.html">PersistenceService</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Insulin.html">Insulin</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Glucose.html">Glucose</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Day.html">Day</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Favourites.html">Favourites</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Meals.html">Meals</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Exercise.html">Exercise</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Illness.html">Illness</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Stress.html">Stress</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Main View.html">Main View</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/ViewControllerMain.html">ViewControllerMain</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/MainViewState.html">MainViewState</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Food Domain.html">Food Domain</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/ViewControllerFood.html">ViewControllerFood</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/IndicatorControllerFood.html">IndicatorControllerFood</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Exercise Domain.html">Exercise Domain</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/ViewControllerExercise.html">ViewControllerExercise</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Health Domain.html">Health Domain</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/ViewControllerHealth.html">ViewControllerHealth</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Advice Domain.html">Advice Domain</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/ViewControllerAdvice.html">ViewControllerAdvice</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Tables.html">Tables</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/ViewControllerTableViewCell.html">ViewControllerTableViewCell</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/tableCellDelegate.html">tableCellDelegate</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Graph.html">Graph</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/ViewControllerGraph.html">ViewControllerGraph</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/ChartPointEllipseView.html">ChartPointEllipseView</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/ChartPointEllipseView/extra.html">– extra</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CustomView.html">CustomView</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/ChartBGView.html">ChartBGView</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Settings.html">Settings</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/SettingsBundleHelper.html">SettingsBundleHelper</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SettingsBundleHelper/SettingsBundleKeys.html">– SettingsBundleKeys</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Other Classes.html">Other Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/AppDelegate.html">AppDelegate</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Other Extensions.html">Other Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Extensions/UIView.html">UIView</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            <h1>Graph</h1>
            <hr>

<p align="center">
    <img src="https://raw.githubusercontent.com/danwells96/ARISES/master/DocFiles/img/Bifocal.png" width="650"/>
</p>
<h2 id='features' class='heading'>Features</h2>

<ul>
<li>The most important information is displayed on the main graph while less relevant, contextual data is displayed on the side views.</li>
<li>Swiping left and right lets users change which days data is being shown on the main face.</li>
<li>The date above the graph bifocal corresponds to the date of the data being shown on the main face. Tapping on this date triggers a picker which lets the user jump to any day. The default date on the picker is set to today’s date for ease of navigation.</li>
<li>Shows monitored blood glucose level in mMol/L during a 24-hour period (to be taken from patients&rsquo; wearable).</li>
<li>To keep the graph area as clean as possible the time interval displayed on the x axis is set to 6 hours.</li>
<li>Meals, exercises and insulin are represented on the main graph using orange, blue and green dots respectively and are appear as soon as they are logged.<br></li>
<li>Pop-ups containing detailed information are triggered when the dots are tapped.

<ul>
<li>For meals this contains name, carbs, protein and fat</li>
<li>For exercise it contains name duration and intensity</li>
<li>For insulin it contains number of units and time administered.</li>
</ul></li>
<li>The side views show the users’ minimum, maximum and mean blood glucose levels on that particular day.</li>
</ul>
<h2 id='chartbase-setup' class='heading'>ChartBase Setup</h2>

<p>The bifocal display consists of three parts: </p>

<ul>
<li>Leftside view container</li>
<li>Main graph section</li>
<li>Rightside view container</li>
</ul>
<h2 id='left-amp-right-side-view-containers' class='heading'>Left &amp; Right Side View Containers</h2>

<p>Each of the side view containers has three subviews of type CustomView (UIView) which are set up to show colours bands as a background.</p>
<h4 id='code-chartbgview-code-and-code-customview-code' class='heading'><code><a href="Classes/ChartBGView.html">ChartBGView</a></code> and <code><a href="Classes/CustomView.html">CustomView</a></code></h4>

<p>The same colour bands are also used on the main chart, so the same logic is used for both*ChartBGView.swift* and <em>CustomView.swift</em>. Additionally, <em>CustomView.swift</em> is used to draw the range bars on each side view, using values calculated from the glucose readings, which are stored in core data where they relate to a certain day.</p>
<h4 id='code-customview-colourmiddleband-code' class='heading'><code><a href="Classes/CustomView.html#/colourMiddleBand()">CustomView.colourMiddleBand()</a></code></h4>

<ul>
<li><p><strong>Description:</strong>
This function draws a white rectangle starting from the midpoint of the view and extending down to cover 20% of it. </p></li>
<li><p><strong>Returns:</strong>
Given the view background colour is set to peach, this yields the image pictured below</p></li>
</ul>

<p align="center">
    <img src="https://raw.githubusercontent.com/danwells96/ARISES/master/DocFiles/img/sideview.png" alt="Image of sideview"/>
</p>
<h4 id='code-customview-drawrangebar-code' class='heading'><code><a href="Classes/CustomView.html#/drawRangeBar()">CustomView.drawRangeBar()</a></code></h4>

<ul>
<li><p><strong>Description:</strong>
This function draws the maximun and minimum dashes as well as the average circle on side views. It does this using the function UIBezierPath (documented [here]), which allows line width and stroke colour to be set. The stroke length is set based on the difference between the maximum and minimum glucose values for the day</p></li>
<li><p><strong>Returns:</strong> A UIView with the range bar drawn on it as pictured below</p></li>
</ul>

<p align="center">
    <img src="https://raw.githubusercontent.com/danwells96/ARISES/master/DocFiles/img/rangeBar.png" alt="Image of range bar"/>
</p>
<h2 id='main-graph-section' class='heading'>Main graph section</h2>
<h3 id='code-viewcontrollergraph-code' class='heading'><code><a href="Classes/ViewControllerGraph.html">ViewControllerGraph</a></code></h3>

<p>This view controller handles everything directly related to the graph. These features are:</p>

<ul>
<li>Transform side view containers into skewed bi-focal ones</li>
<li>Load temporary arrays into Core Data</li>
<li>Create the date picker when the current date is clicked on<br></li>
<li>Update graph based on settings<br></li>
<li>Trigger pop-ups based as activities dots are selected</li>
</ul>

<p>To do this, modifications are made on top of an iOS chart library which can be found <a href="https://github.com/i-schuetz/SwiftCharts.git">here</a>
The layers used are described below.</p>

<p><strong>xAxisLayer</strong> contains model and label settings for the time axis (x-axis). It spans 24 hours from, starting and ending at midnight, with time intervals of 6 hours.</p>

<p><strong>yAxisLayer</strong> contains model and label settings for the glucose axis (y-axis). The axis range is set to go from 0 to 20 (mM/L) with an interval of 4. </p>

<p><strong>yHighAxes</strong> contains an invisible carbs axis on the right side of chart against which meal dots are plotted to make them higher up if they contain more carbs.</p>

<p><strong>guidelinesLayer</strong> provides dotted grid lines on graph.</p>

<p><strong>pointslineLayer</strong> draws glucose curve on graph in a solid blue line</p>

<p><strong>prediction</strong> shows the red dotted prediction line for the next half hour of the patient’s glucose levels</p>

<p><strong>chartPointsCircleLayer</strong> is where the pop-ups are set. It uses a touchHandler to determine which dot has been tapped so the correct message can be displayed. The touchHandler detects where the finger taps on the screen and compares the x-position of the touch with the x coordinates of stored pop-ups. If they match within a degree of tolerance the infoBubble is enabled which displays a message to user.</p>

          </section>
          <section class="section task-group-section">
            <div class="task-group">
              <ul>
                <li class="item">
                  <div>
                    <code>
                    <a name="/"></a>
                    <a name="//apple_ref/swift/Class/ViewControllerGraph" class="dashAnchor"></a>
                    <a class="token" href="#/">ViewControllerGraph</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>The UIViewController subclass for the top half of the app&rsquo;s UI. It controls the bifocal display utilising the SwiftCharts library, referenced in
the documentation.</p>

                        <a href="Classes/ViewControllerGraph.html" class="slightly-smaller">See more</a>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/"></a>
                    <a name="//apple_ref/swift/Extension/ChartPointEllipseView" class="dashAnchor"></a>
                    <a class="token" href="#/">ChartPointEllipseView</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Extension to the ChartPointEllipseView class from the SwiftCharts library allowing a string to be associated with an individual 
point on the chart, which gives the method for determining what text should be displayed on the point&rsquo;s popup.</p>

                        <a href="Extensions/ChartPointEllipseView.html" class="slightly-smaller">See more</a>
                      </div>
                    </section>
                  </div>
                </li>
              </ul>
            </div>
            <div class="task-group">
              <ul>
                <li class="item">
                  <div>
                    <code>
                    <a name="/"></a>
                    <a name="//apple_ref/swift/Class/CustomView" class="dashAnchor"></a>
                    <a class="token" href="#/">CustomView</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>The class is a subclass of UIView and is used in the bifocal display as the sideViews. It includes methods to draw the daily glucose
ranges calculated using the member data and to draw the upper band for the background &lsquo;safe&rsquo; range.</p>

                        <a href="Classes/CustomView.html" class="slightly-smaller">See more</a>
                      </div>
                    </section>
                  </div>
                </li>
              </ul>
            </div>
            <div class="task-group">
              <ul>
                <li class="item">
                  <div>
                    <code>
                    <a name="/"></a>
                    <a name="//apple_ref/swift/Class/ChartBGView" class="dashAnchor"></a>
                    <a class="token" href="#/">ChartBGView</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>This class is a subclass of UIView used to create the three bands of the &lsquo;safe&rsquo; range for the background of the chart using it&rsquo;s 
methods.</p>

                        <a href="Classes/ChartBGView.html" class="slightly-smaller">See more</a>
                      </div>
                    </section>
                  </div>
                </li>
              </ul>
            </div>
          </section>
        </section>
        <section id="footer">
          <p>&copy; 2019 <a class="link" href="" target="_blank" rel="external">Ryan Armiger, Becky Elkington, Xiaoyu Ma, Dan Wells</a>. All rights reserved. (Last updated: 2019-01-20)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.9.4</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
